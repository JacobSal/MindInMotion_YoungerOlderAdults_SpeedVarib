TIME_BOUND = [0,1500]
FREQ_BOUND = [4,60];

%* ERSP PARAMS
ERSP_STAT_PARAMS = struct('condstats','on',... % ['on'|'off]
    'groupstats','off',... %['on'|'off']
    'method','perm',... % ['param'|'perm'|'bootstrap']
    'singletrials','off',... % ['on'|'off'] load single trials spectral data (if available). Default is 'off'.
    'mode','fieldtrip',... % ['eeglab'|'fieldtrip']
    'fieldtripalpha',0.05,... % [NaN|alpha], Significance threshold (0<alpha<<1)
    'fieldtripmethod','montecarlo',... %[('montecarlo'/'permutation')|'parametric']
    'fieldtripmcorrect','cluster',...  % ['cluster'|'fdr']
    'fieldtripnaccu',2000);
ERSP_PARAMS = struct('subbaseline','off',...
    'timerange',[],...
    'ersplim',[-2,2],...
    'freqfac',4,...
    'cycles',[3,0.8],...
    'freqrange',[1,200]);
%## ersp plot per cluster per condition
STUDY = pop_statparams(STUDY,'condstats',ERSP_STAT_PARAMS.condstats,...
        'groupstats',ERSP_STAT_PARAMS.groupstats,...
        'method',ERSP_STAT_PARAMS.method,...
        'singletrials',ERSP_STAT_PARAMS.singletrials,'mode',ERSP_STAT_PARAMS.mode,...
        'fieldtripalpha',ERSP_STAT_PARAMS.fieldtripalpha,...
        'fieldtripmethod',ERSP_STAT_PARAMS.fieldtripmethod,...
        'fieldtripmcorrect',ERSP_STAT_PARAMS.fieldtripmcorrect,'fieldtripnaccu',ERSP_STAT_PARAMS.fieldtripnaccu);
STUDY = pop_erspparams(STUDY,'subbaseline',ERSP_PARAMS.subbaseline,...
      'ersplim',ERSP_PARAMS.ersplim,'freqrange',ERSP_PARAMS.freqrange);
      
PLOT_STRUCT_PAR = struct('figure_position_inch',[0.5,0.5,6.5,9],...
    'alltitles',{{}},...
    'xlabel','Gait Cycle Time (ms)',...
    'ylabel','Frequency (Hz)',...
    'xticklabel_times',[0,100,1000],...
    'xticklabel_chars',{{'1','2','3'}}},...
    'clim',[],...
    'font_size',[],...
    'font_name','Arial',...
    'freq_lims',FREQ_BOUND,...
    'time_lims',TIME_BOUND,...
    'subplot_width',[],...
    'subplot_height',[],... %(02/17/2024) was 0.2
    'horiz_shift_amnt',[],...
    'vert_shift_amnt',[],...
    'group_titles',{{}},...
    'stats_title','F Statistic Mask',...
    'figure_title','');

%## RUN BASELINE
[allerspo_f,allerspo,~,~] = eeglab_baseln(erspdata,alltimes,allfreqs,...
            TIME_BOUND,FREQ_BOUND,...
            'DO_COMMON_BASE',false,...
            'DO_SUBJ_BASE',true);

%## STATS
[pcond_ersp_crop, ~, ~] = ersp_stats_conds(STUDY,allerspo,allfreqs,alltimes);

#%% AVERAGE ACROSS CONDITIONS
for cond_i = 1:size(allerspo,1)
    p1{cond_i} = squeeze(mean(allerspo{cond_i},3));
end

#%% PLOT
[fig] = plot_txf_mask_contourf(clust_ersp,alltimes,allfreqs,clust_maskedersp,clust_maskedersp,{},...
            'PLOT_STRUCT',PLOT_STRUCT_PAR);

fig = plot_txf_conds_tftopo(p1,alltimes,allfreqs,pcond_ersp_crop,{},...
    'PLOT_STRUCT',PLOT_STRUCT_PAR);