lme_cc=character(),
coeff_m=character(),
coeff_b=character(),
pwc_cc=character(),
pwc_est=character(),
pwc_pval=character(),
confint_chars=character(),
emmeans=character(),
emmeans_se=character(),
confint_lwr=character(),
confint_upr=character(),
ttn0_cc=character(),
ttn0_est=character(),
ttn0_pval=character(),
ttna0_cc=character(),
ttna0_est=character(),
ttna0_pval=character(),
emm_slp_cc=character(),
emm_slp_est=character(),
emm_slp_se=character(),
emm_slp_df=character(),
emm_slpcon_cc=character(),
emm_slpcon_est=character(),
emm_slpcon_pval=character(),
emm_slpcon_se=character(),
emm_slpcon_trat=character(),
emm_slptt_cc=character(),
emm_slptt_est=character(),
emm_slptt_pval=character(),
emm_slptt_se=character(),
emm_slptt_trat=character(),
anv_chars=character(),
anv_pvals=character(),
anv_stats=character(),
anv_dfs=character(),
r2_m_int=double(),
r2_c_int=double(),
f2_m_int=double(),
f2_c_int=double(),
fsq_chars=character(),
fsq_vals=character(),
etasq_chars=character(),
etasq_vals=character(),
ran_effs_char=character(),
ran_effs_n=character())
#%% ======================================================================== %%#
#%% HTML TAG
cat(paste0("\n\n# Interaction Models\n"))
# SPEED INTERACITON
theme_set(theme_classic()) # This sets the default ggplot theme
#%% LOOP VARS
tmp <- length(clusters)*length(clusters)-length(clusters)
cis <- rep(NA,tmp*length(eeg_measures))
eis <- rep(NA,tmp*length(eeg_measures))
cjs <- rep(NA,tmp*length(eeg_measures))
cnt = 1;
for (i in 1:length(clusters)) {
for (j in 1:length(clusters)) {
for(k in 1:length(eeg_measures)){
if (i!=j) {
cis[cnt] = i;
cjs[cnt] = j;
eis[cnt] = k;
cnt = cnt + 1;
}
}
}
}
i = 1
ci = clusters[cis[i]];
cj = clusters[cjs[i]];
ei = eeg_measures[eis[i]];
#%% HTML TAG
cat(paste0("\n\n## ",ei,',',cluster_chars[cis[i]],'->',cluster_chars[cjs[i]],"\n"))
#%% SUBSET BY CLUSTER
tmpt <- filter_at(dtbl,vars('cluster_n_fr'), any_vars(. %in% ci));
tmpt <- filter_at(tmpt,vars('cluster_n_to'), any_vars(. %in% cj));
# -- remove NAN cases
tmpt = tmpt[complete.cases(tmpt[[ei]]),];
#%% COMPUTE LME MODEL
mod_char = paste(ei," ~ 1 + speed_n + group_char + speed_n:group_char + (1|subj_char)");
# mod <- lme4::lmer(str_glue(mod_char), data=tmpt);
mod <- lmerTest::lmer(str_glue(mod_char), data=tmpt);
sm = summary(mod)
#%% PRINT TABLE
tbl <- mod %>%
tbl_regression(tidy_fun = broom.mixed::tidy,
pvalue_fun = purrr::partial(style_pvalue, digits = 2),
intercept=TRUE) %>%
add_global_p() %>%
add_q()
t_out <- as_gt(tbl) %>%
gt::tab_header(title=c(ei,") for Connection ",ci,"-",cj)) %>%
gt::tab_options(table.layout = "fixed") %>%
gt::as_raw_html()
print(t_out)
# #-- extract fixed & random effects coeffs
anv_vals <- car::Anova(mod,type=3)
fix_effs <- fixef(mod)
ran_effs <- ranef(mod)$subj_char
#%% EFFECT SIZES
cat(paste0("\n\n### model effect sizes\n"))
#-- Intercept Model for Cohen's f^2
print('intercept model\n');
mod_char_int = paste(ei," ~ 1 + (1|subj_char)");
mod <- lmerTest::lmer(str_glue(mod_char), data=tmpt);
sfit <- summary(mod)
lme_est <- as.numeric(sfit$coefficients[, "Estimate"])
lme_pval <- as.numeric(sfit$coefficients[, "Pr(>|t|)"])
lme_stat <- as.numeric(sfit$coefficients[,"t value"])
lme_cc <- rownames(sfit$coefficients[,])
#-- extract fixed & random effects coeffs
# anv_vals <- car::Anova(mod,type=3)
# anv_chars=paste0(unlist(row.names(anv_vals)),collapse=',')
# anv_pvals=paste0(unlist(anv_vals$`Pr(>Chisq)`),collapse=',')
# anv_stats=paste0(unlist(anv_vals$Chisq),collapse=',')
# anv_dfs=paste0(unlist(anv_vals$Df),collapse=',')
#--
anv_vals <- anova(mod)
anv_chars=paste0(unlist(row.names(anv_vals)),collapse=',')
anv_pvals=paste0(unlist(anv_vals$`Pr(>F)`),collapse=',')
anv_stats=paste0(unlist(anv_vals$`F value`),collapse=',')
anv_dfs=paste0(unlist(anv_vals$DenDF),collapse=',')
fix_effs <- fixef(mod)
ran_effs <- ranef(mod)$subj_char
#%% EFFECT SIZES
cat(paste0("\n\n### model effect sizes\n"))
#-- Intercept Model for Cohen's f^2
print('intercept model\n');
mod_char_int = paste0(ei," ~ 1 + (1|subj_char)");
tmp_mod = lme4::lmer(str_glue(mod_char_int), data=tmpt)
cf_alt = calc_cohensf2(mod, tmp_mod)
#-- calculate effect sizes using r-package
anv_vals_f <- car::Anova(mod,type=3,test.statistic = "F")
etasq_res <- effectsize::eta_squared(anv_vals_f, partial = TRUE)
cohens_fsq_res <- effectsize::cohens_f_squared(anv_vals_f, partial = TRUE)
#-- confidence intervals
summ <- summary(mod);
coeff_chars = row.names(summ$coefficients)
emm = emmeans::emmeans(mod,spec=c('speed_n','group_char'),level=0.95);
bfc = emmeans::contrast(emm,adjutst="bonferroni")
pwc = emmeans::contrast(emm,method="pairwise")
ttz = data.frame(emmeans::test(emm,null=0))
#--
emma = emmeans::emmeans(mod,spec=c('speed_n'),level=0.95);
ttza = data.frame(emmeans::test(emma,null=0))
#-- design mat
desm = unique(mod@pp[[".->X"]]);
desm = format_csv(data.frame(desm));
#--
cfis <- data.frame(emm)
pwcs = data.frame(pwc)
#--
emms = emtrends(mod, pairwise ~ group_char, var = "speed_n")
emm_slp = data.frame(emms$emtrends)
emm_slpcon = data.frame(emms$contrasts)
emm_slptt = test(emtrends(mod, specs = ~ group_char, var = "speed_n"), side = "two_sided")
emm_slpcontt = data.frame(emm_slptt)
# print(kable(cfis));
print(kable(anv_vals));
# print(kable(data.frame(bfc)));
# print(kable(data.frame(pwc)));
#%% EXCEL PRINTS
new_row = data.frame(cluster_n_fr=ci,
cluster_n_to=cj,
group_char=c('all'),
model_char=c('speed_group_intact_all'),
kinematic_char='none',
freq_band_char=c(ei),
mod_num_obs=nrow(tmpt),
coeff_chars=paste0(unlist(coeff_chars),collapse=','),
coeffs=paste0(unlist(mod@beta),collapse=','),
coeff_desm=desm,
lme_pval=paste0(unlist(lme_pval),collapse=','),
lme_est=paste0(unlist(lme_est),collapse=','),
lme_stat=paste0(unlist(lme_stat),collapse=','),
lme_cc=paste0(unlist(lme_cc),collapse=','),
pwc_cc=paste0(unlist(pwcs$contrast),collapse=','),
pwc_est=paste0(unlist(pwcs$estimate),collapse=','),
pwc_pval=paste0(unlist(pwcs$p.value),collapse=','),
confint_chars=paste0(unlist(cfis$group_char),collapse=','),
emmeans=paste0(unlist(as.numeric(cfis$emmean)),collapse=','),
emmeans_se=paste0(unlist(as.numeric(cfis$SE)),collapse=','),
confint_lwr=paste0(unlist(as.numeric(cfis$lower.CL)),collapse=','),
confint_upr=paste0(unlist(as.numeric(cfis$upper.CL)),collapse=','),
ttn0_cc=paste0(unlist(as.numeric(ttz$group_char)),collapse=','),
ttn0_est=paste0(unlist(as.numeric(ttz$emmean)),collapse=','),
ttn0_pval=paste0(unlist(as.numeric(ttz$p.value)),collapse=','),
ttna0_cc="all",
ttna0_est=paste0(unlist(as.numeric(ttza$emmean)),collapse=','),
ttna0_pval=paste0(unlist(as.numeric(ttza$p.value)),collapse=','),
emm_slp_cc=paste0(unlist(emm_slp$group_char),collapse=','),
emm_slp_est=paste0(unlist(as.numeric(emm_slp[,'speed_n.trend'])),collapse=','),
emm_slp_se=paste0(unlist(as.numeric(emm_slp$SE)),collapse=','),
emm_slp_df=paste0(unlist(as.numeric(emm_slp$df)),collapse=','),
emm_slpcon_cc=paste0(unlist(emm_slpcon$contrast),collapse=','),
emm_slpcon_est=paste0(unlist(as.numeric(emm_slpcon$estimate)),collapse=','),
emm_slpcon_pval=paste0(unlist(as.numeric(emm_slpcon$p.value)),collapse=','),
emm_slpcon_se=paste0(unlist(as.numeric(emm_slpcon$SE)),collapse=','),
emm_slpcon_trat=paste0(unlist(as.numeric(emm_slpcon$t.ratio)),collapse=','),
emm_slptt_cc=paste0(unlist(emm_slpcontt$group_char),collapse=','),
emm_slptt_est=paste0(unlist(as.numeric(emm_slpcontt[,'speed_n.trend'])),collapse=','),
emm_slptt_pval=paste0(unlist(as.numeric(emm_slpcontt[,'p.value'])),collapse=','),
emm_slptt_se=paste0(unlist(as.numeric(emm_slpcontt[,'SE'])),collapse=','),
emm_slptt_trat=paste0(unlist(as.numeric(emm_slpcontt[,'t.ratio'])),collapse=','),
anv_chars=anv_chars,
anv_pvals=anv_pvals,
anv_stats=anv_stats,
anv_dfs=anv_dfs,
r2_m_int=cf_alt$r2m,
r2_c_int=cf_alt$r2c,
f2_m_int=cf_alt$f2m,
f2_c_int=cf_alt$f2c,
fsq_chars=paste0(unlist(cohens_fsq_res$Parameter),collapse=','),
fsq_vals=paste0(unlist(cohens_fsq_res$Cohens_f2_partial),collapse=','),
etasq_chars=paste0(unlist(etasq_res$Parameter),collapse=','),
etasq_vals=paste0(unlist(etasq_res$Eta2_partial),collapse=','),
ran_effs_char=paste0(unlist(row.names(ran_effs)),collapse=','),
ran_effs_n=paste0(unlist(ran_effs$`(Intercept)`),collapse=','))
excel_df <- rbind(excel_df,new_row)
#%% MODEL VALIDATION PLOTS
cat(paste0("\n\n### model validations\n"))
print(plot_model(mod, type = 'diag'))
cat("\n")
tmpt$fit.m <- predict(mod, re.form = NA)
tmpt$fit.c <- predict(mod, re.form = NULL)
#%% VISUALIZATION OF MODELS
cat(paste0("\n\n### data plot\n"))
theme_set(theme_classic()) # This sets the default ggplot theme
# print(
#   tmpt %>%
#     ggplot() +
#     geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
#     geom_line(aes(x= speed_n, y=fit.c, group = subj_char),linetype = "dashed", linewidth = .5) +
#     geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
#     geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='red') +
#     facet_wrap(~group_char) +
#     ggtitle(paste0('Connection ',ci,'-',cj))+
#     xlab("Treadmill Speed (m/s)") +
#     ylab(eeg_title_chars[eis[i]]) +
#     guides(group="none")
# )
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_txt(face="bold",color="#000000",
size=12))+
theme(axis.text.y=element_txt(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")
)
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=20))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=45))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=45))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char), pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m), linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL), width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=30))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char),
width=1,height=1,pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m),
linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL),
width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=30))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)''
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char),
width=1,height=1,pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m),
linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL),
width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=30))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char),
width=1,height=1,pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m),
linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL),
width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=30))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char),
width=0.01,height=0.01,pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m),
linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL),
width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=30))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char),
width=0.02,height=0.0,pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m),
linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL),
width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=30))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)
print(
tmpt %>%
ggplot() +
geom_jitter(aes(x = speed_n, y = .data[[ei]], color = subj_char),
width=0.033,height=0.0,pch=20, size=10, alpha=0.2) +
geom_line(aes(x= speed_n, y=fit.m),
linewidth = 2)+
geom_errorbar(data=cfis,aes(x = speed_n, ymin=lower.CL, ymax=upper.CL),
width=0.33, linewidth=1.5, colour='black') +
facet_wrap(~group_char) +
ggtitle(paste0('Connection from',ci,'->',cj))+
xlab("") +
ylab("") +
theme(axis.text.x=element_text(face="bold",color="#000000",
size=12, angle=30))+
theme(axis.text.y=element_text(face="bold",color="#000000",
size=12))+
scale_x_continuous(limits=c(0,1.25),
breaks=c(0.25,0.50,0.75,1.0),
labels=c("0.25","0.50","0.75","1.0"))+
guides(group="none")+
theme(legend.position="none")
)
